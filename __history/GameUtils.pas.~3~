unit GameUtils;

interface

uses
  Kosticka, Tvar, Smer;

type
  VlozeniKostkyStatus = (OK, KOLIZE_SE_STENOU, KOLIZE_S_KONCEM, KOLIZE_S_KOSTKOU_ZE_STRANY);   //enum
  function copy(src : TArray<TArray<TKosticka>>) : TArray<TArray<TKosticka>>;
  function vlozeniKosticky(kostka : TTvar; zdroj,novePole : TArray<TArray<TKosticka>>; smer : TSmer) : VlozeniKostkyStatus;

implementation

function copy(src : TArray<TArray<TKosticka>>) : TArray<TArray<TKosticka>>;
var
  copy : TArray<TArray<TKosticka>>;
  i,j : Integer;
begin
  SetLength(copy,Length(src),Length(src[0]));
  for i := 0 to Length(src) do begin
    for j := 0 to Length(src[0]) do begin
      copy[i][j] := src[i][j];
    end;
  end;
  result := copy;
end;

function vlozeniKosticky(kostka : TTvar; zdroj,novePole : TArray<TArray<TKosticka>>; smer : TSmer) : VlozeniKostkyStatus;
var
  x,y,radek,sloupec : Integer;
  status : VlozeniKostkyStatus;
  smer2 : TSmer;
  label
    loop;
begin

  x := kostka.getX() + smer.getX(); //zmìna souøednic
  y := kostka.getY() + smer.getY();

  status := VlozeniKostkyStatus.OK;

  loop : for radek := 0 to Length(kostka.getTvar) do begin                   // bacha na -1 ... možná to bude potøeba
    for sloupec := 0 to Length(kostka.getTvar[0]) do begin

      if (kostka.getTvar[radek][sloupec] = nil) then continue;

      if (((sloupec + x) >= Length(zdroj[0])) or ((sloupec + x) < 0)) then begin    //kontrola jestli kostka nenarazila na levou nebo pravou stìnou
        status := VlozeniKostkyStatus.KOLIZE_SE_STENOU;
        GoTo loop;
      end;

      if ((radek + y) = Length(zdroj)) then begin     //kontrola jestli kostka nedopadla ke spodní hranì
        status := VlozeniKostkyStatus.KOLIZE_S_KONCEM;
        break;
      end;

      if (zdroj[radek + y][sloupec + x] = nil) then
        novePole[radek + y][sloupec + x] = kostka.getTvar()[radek][sloupec]
      else
        smer2 := TDolu.Create;
        if ((smer.getX <> smer2.getX) and (smer.getY <> smer2.getY)) then
          status := VlozeniKostkyStatus.KOLIZE_S_KOSTKOU_ZE_STRANY
        else
          status := VlozeniKostkyStatus.KOLIZE_S_KONCEM;
        break;
    end;      //TODO: vyøešit break
  end;
end;

end.
